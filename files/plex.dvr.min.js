!function(c,e){"use strict";var s=["DEU","DNK","ESP","FRA","GBR","ITA","CHE","NOR","SWE","AUT","FIN"],r={CYM:["logictv","weststar"]},t=!1,i="https://tmsimg.plex.tv/sources/generic/generic_sources_h5.png",a="",o="",n="",l=!0,d="en_US",p=null,u=null,g=null,v=c('.remodal-channels[data-remodal-id="remodal-channels"]'),h=c(".lineup-country"),f=c(".lineup-postal-code"),y=c(".channel-postal-input"),m=c(".lineup-loader"),E=c(".lineups-results"),I=c(".lineup-channels"),C=c(".lineup-region"),x=C,_=c(".lineup-errors"),O=c(".lineup-errors-modal"),S=c(".lineup-options"),P=c(".bt-lineups"),L=null,A=0,N=[],T=[],R=[],w={},D={},Q={},b={selOptions:{country:"",postalCode:"",regionId:"",lineupId:"",providerId:""},EyeQ:{API:{userID:"",validProviderTypes:["DBC","CAB"],baseImagesURL:"http://akamai-b.cdn.cddbp.net/cds/2.0/image/"},_getRegions:function(e,n){if((T=b.getCachedRegions(e,n)).length)return 1===T.length&&(a=T[0].id,b.selOptions.regionId=a,b.getLineups(e,a,n)),void b.populateRegionsDropown(T);var o={user_id:b.EyeQ.API.userID,country:e.code.toLowerCase(),postal_code:n,lang:e.lang};p=c.ajax({type:"GET",url:plex_l10n.dvr.endpoint.replace("_ENDPOINT_","plex/v1/dvr/region"),headers:{"X-WP-Nonce":plex_l10n.dvr.rest_token},data:o,success:function(e){if("OK"===c(e).find("RESPONSE").attr("STATUS")){var n=c(e).find("TVREGION"),r=[];c.each(n,function(e,n){var o={};if(o.id=c(n).attr("ID"),o.name=c(n).text(),0<=c.inArray(o.id,r))return!0;T.push(o),r.push(o.id)}),b.populateRegionsDropown(T)}else b.displayError(plex_l10n.dvr.error.generic,c(e).find("MESSAGE").text(),"")},error:function(e){b.displayError("Could not get country regions at this time. Please try again later."),void 0!==e.responseJSON&&console.log(e.responseJSON)}})},getRegions:function(n,o){if(o=void 0!==o?o:0,m.show(),plex_l10n.dvr.eyeq.user_id&&(b.EyeQ.API.userID=plex_l10n.dvr.eyeq.user_id),b.EyeQ.API.userID)return b.EyeQ._getRegions(n,o),!0;p=c.ajax({type:"GET",url:plex_l10n.dvr.endpoint.replace("_ENDPOINT_","plex/v1/dvr/client"),headers:{"X-WP-Nonce":plex_l10n.dvr.rest_token},success:function(e){"OK"===c(e).find("RESPONSE").attr("STATUS")?(b.EyeQ.API.userID=c(e).find("USER").text(),b.EyeQ._getRegions(n,o)):b.displayError(plex_l10n.dvr.error.generic,plex_l10n.dvr.error.invalid_user)},error:function(e){b.displayError("Could not get country regions at this time. Please try again later."),void 0!==e.responseJSON&&console.log(e.responseJSON)}})},getLineups:function(n,o,r){b.EyeQ.API.userID?b.EyeQ._getLineups(n,o,r):(m.show(),p=c.ajax({type:"GET",url:plex_l10n.dvr.endpoint.replace("_ENDPOINT_","plex/v1/dvr/client"),headers:{"X-WP-Nonce":plex_l10n.dvr.rest_token},success:function(e){"OK"===c(e).find("RESPONSE").attr("STATUS")?(b.EyeQ.API.userID=c(e).find("USER").text(),b.EyeQ._getLineups(n,o,r)):b.displayError(plex_l10n.dvr.error.generic,plex_l10n.dvr.error.invalid_user)},error:function(e){b.displayError("Could not get lineups at this time. Please try again later."),void 0!==e.responseJSON&&console.log(e.responseJSON)}}))},_getLineups:function(e,n,o){o=void 0!==typeof o?o:0,m.show();var r={user_id:b.EyeQ.API.userID,country:e.code.toLowerCase(),lang:e.lang,region_id:n,postal_code:o};p=c.ajax({type:"GET",url:plex_l10n.dvr.endpoint.replace("_ENDPOINT_","plex/v1/dvr/lineups"),data:r,headers:{"X-WP-Nonce":plex_l10n.dvr.rest_token},success:function(e){var n=!0;"OK"===c(e).find("RESPONSE").attr("STATUS")||(n=!1)||N.length?(n&&c(e).find("TVPROVIDER").each(function(){if(!(c.inArray(c(this).find("PROVIDERTYPE").text().trim(),b.EyeQ.API.validProviderTypes)<0)){var n={lineupId:c(this).find("GN_ID").text(),type:b.normalizeLineupType(c(this).find("PROVIDERTYPE").text()),name:c(this).find("NAME").text(),provider:"eyeq"};c.grep(N,function(e){return e.name==n.name}).length||N.push(n)}}),b.populateLineupsDropdown(N)):b.displayError(plex_l10n.dvr.error.generic,c(e).find("MESSAGE").text())},error:function(e){b.displayError("Could not get lineups at this time. Please try again later."),void 0!==e.responseJSON&&console.log(e.responseJSON)}})},getLineupChannels:function(e,n){m.show();var o={user_id:b.EyeQ.API.userID,country:e.code.toLowerCase(),lang:e.lang,lineup_id:n,images_width:110};p=c.ajax({type:"GET",url:plex_l10n.dvr.endpoint.replace("_ENDPOINT_","plex/v1/dvr/channels"),data:o,headers:{"X-WP-Nonce":plex_l10n.dvr.rest_token},success:function(e){"OK"===c(e).find("RESPONSE").attr("STATUS")?(c(e).find("RESPONSE > TVCHANNEL").each(function(){var e=c(this).find("CHANNEL_NUM").first().text(),n={name:c(this).find("NAME").first().text(),lineupId:c(this).find("GN_ID").first().text(),stationId:e,channel:e,logo:{src:b.EyeQ.getChannelImage(c(this).find("URL").first().text()),width:void 0!==c(this).find("URL").first().attr("WIDTH")?c(this).find("URL").first().attr("WIDTH"):110}};R.push(n)}),b.populateLineupChannels(R),I.fadeIn()):b.displayError(plex_l10n.dvr.error.generic,c(e).find("MESSAGE").text())},error:function(e){b.displayError("Could not get lineups at this time. Please try again later."),void 0!==e.responseJSON&&console.log(e.responseJSON)}})},getChannelImage:function(e){if(!e)return i;if(0<=e.indexOf(b.EyeQ.API.baseImagesURL))return e;var n=b.EyeQ.getParameterByName("type",e);n||(n="image/png");var o={id:b.EyeQ.getParameterByName("id",e),size:b.EyeQ.getParameterByName("size",e),type:{"image/jpeg":".jpeg","image/jpg":".jpg","image/png":".png","image/gif":".gif"}[n]},r=o.id.match(/.{1,4}/g);return e=b.EyeQ.API.baseImagesURL+r.join("/")+"_"+o.size+o.type},getParameterByName:function(e,n){e=e.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(n);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}},OnConnect:{API:{key:"szprf72zjxnmwp3mq32b7r9n",url:"https://tmsapi.plex.tv/v1.1/",imagesUrl:"https://tmsimg.plex.tv",validProviderTypes:["OTA","CABLE"]},getLineups:function(t,i,a,l){l=void 0!==l&&l,m.show(),c.ajax({dataType:"json",type:"GET",url:b.OnConnect.API.url+"lineups",crossDomain:!0,data:{api_key:b.OnConnect.API.key,country:t.code,postalCode:a},success:function(e){c.each(e,function(e,n){var o=!1;c.inArray(n.type,b.OnConnect.API.validProviderTypes)<0||(void 0!==r[t.code]&&c.grep(r[t.code],function(e){return 0<=n.name.toLowerCase().indexOf(e)}).length&&(o=!0),n.name=n.name.replace("- Cable","").trim(),n.name=n.name.replace("- Satellite","").trim(),n.provider="onconnect",n.type=b.normalizeLineupType(n.type),c.grep(N,function(e){return e.name==n.name}).length||o||N.push(n))}),A++,0<=c.inArray(t.code,s)&&A<=1?b.EyeQ.getLineups(t,i,a):b.populateLineupsDropdown(N)},error:function(e,n){if(l){var o=plex_l10n.dvr.error.generic;1005!==e.responseJSON.errorCode&&0===t.flavor||(o="Could not find any channels. Please confirm the postal code is correct."),b.displayError(o,e.responseJSON.errorCode)}else{var r=b.filterPostalCode(a);r&&b.OnConnect.getLineups(t,i,r,!0)}}})},getLineupChannels:function(e,n){var t=[],i=[];m.show(),c.ajax({dataType:"json",type:"GET",url:b.OnConnect.API.url+"lineups/"+n+"/channels",crossDomain:!0,data:{api_key:b.OnConnect.API.key,lineupId:n,imageSize:"Sm"},success:function(e){c.each(e,function(e,n){var o=!1;void 0!==n.affiliateCallSign&&(c.inArray(n.affiliateCallSign,i)<0?i.push(n.affiliateCallSign):o=n.affiliateCallSign+" ("+n.callSign+")");var r={name:void 0!==n.affiliateCallSign?o||n.affiliateCallSign:n.callSign,lineupId:n.lineupId,stationId:n.stationId,channel:n.channel,logo:{src:b.OnConnect.getChannelImage(n),width:110}};t.push(r)}),b.populateLineupChannels(t)},error:function(e,n){b.displayError(plex_l10n.dvr.error.generic,e.responseJSON.errorCode)}})},getChannelImage:function(e){return void 0!==e.preferredImage.uri?e.preferredImage.uri.replace("http://plex.tmsimg.com",b.OnConnect.API.imagesUrl):i}},getCachedRegions:function(e,n){if(T=[],void 0!==w[e.code]){if(n&&void 0!==w[e.code][n])return w[e.code][n];if(!n)return w[e.code]}var o=c.parseJSON(plex_l10n.dvr.country_data.regions);return void 0!==o[e.code]&&void 0!==o[e.code][n]&&Object.keys(o).length?o[e.code][n]:[]},getCachedLineups:function(e,n,o){if(N=[],void 0!==D[e.code]){if(o&&void 0!==D[e.code][o])return D[e.code][o];if(n&&void 0!==D[e.code][n])return D[e.code][n]}var r=c.parseJSON(plex_l10n.dvr.country_data.lineups);return void 0!==r[e.code]&&void 0!==r[e.code][o]&&Object.keys(r).length?(0<=c.inArray(e.code,s)&&A++,r[e.code][o]):[]},getCachedLineupChannels:function(e,n){return R=[],void 0!==Q[e.code]&&void 0!==Q[e.code][n]?Q[e.code][n]:[]},getLineups:function(e,n,o){if(n=void 0!==n?n:0,!(N=b.getCachedLineups(e,o,n)).length||A)0===e.flavor?b.EyeQ.getLineups(e,n,o):b.OnConnect.getLineups(e,n,o);else if(1===N.length){var r=N[0].lineupId;b.selOptions.lineupId=r,b.getLineupChannels(e,r)}else b.populateLineupsDropdown(N)},getLineupChannels:function(e,n){var o="";o=0===e.flavor||"eyeq"===b.selOptions.providerId?b.EyeQ:b.OnConnect,(R=b.getCachedLineupChannels(e,n)).length?m.show(function(){b.populateLineupChannels(R)}):o.getLineupChannels(e,n)},populateLineupsDropdown:function(e){m.show();var n=b.selOptions.country,o=b.selOptions.postalCode,r=b.selOptions.regionId,a=0,l=c("optgroup.lineup-model");c(".lineup:not(optgroup.lineup-model)").remove(),e.sort(function(e,n){var o=e.type,r=n.type,t=e.name,i=n.name;return i<t&&o===r?1:t<i&&o===r?-1:r<o?-1:o<r?1:0});var s="",d="",p=0;c.each(e,function(e,n){var o=n.name,r=n.type,t=d;s&&s===n.type||(t=l.clone().appendTo(".lineups-dropdown")).attr("label",r).removeClass("lineup-model");var i=c("<option/>");i.val(n.lineupId).text(o).attr("data-provider",n.provider),t.append(i),a++,t.show(),s=n.type,d=t,p=n.lineupId}),1<a?E.fadeIn():1===a?c(".lineups-dropdown").val(p).trigger("change"):b.displayError(plex_l10n.dvr.error.no_ota_providers),void 0===D[n.code]&&(D[n.code]={}),r?void 0===D[n.code][r]&&(D[n.code][r]=e):void 0===D[n.code][o]&&(D[n.code][o]=e),1<a&&m.hide()},populateLineupChannels:function(e){var n=b.selOptions.country,o=b.selOptions.lineupId;t&&t.appendTo(I);var r=c(".lineup-channel-model",I);c(".lineup-channel:not(.lineup-channel-model)",I).remove(),e.sort(function(e,n){var o=999*e.channel,r=999*n.channel;return e.logo.src.indexOf("/generic")<0&&(o/=999),n.logo.src.indexOf("/generic")<0&&(r/=999),o-r}),c.each(e,function(e,n){var o=r.clone().appendTo(".lineup-channels");o.removeClass("lineup-channel-model"),o.attr("data-lineup-id",n.lineupId).attr("data-lineup-station-id",n.stationId),c(".lineup-channel-logo",o).attr("src",n.logo.src).attr("title",n.name).attr("width",n.logo.width),c(".lineup-channel-name",o).html(n.name),o.show()}),I.fadeIn(),t=r.detach(),void 0===Q[n.code]&&(Q[n.code]={}),void 0===Q[n.code][o]&&(Q[n.code][o]=e),m.hide()},populateRegionsDropown:function(e){var n=b.selOptions.country,o=b.selOptions.postalCode,r=C,t=0;c("option",r).remove();var i=c("<option/>");c.each(e,function(e,n){var o=c("<option/>");o.val(n.id).text(n.name),t=n.id,r.append(o)}),1<e.length?(S.find(".lineup-dynamic").hide(),f.closest(".lineup-dynamic").hide(),i.val("").text("Please choose a region... "),r.prepend(i),r.val(""),r.closest(".lineup-dynamic").fadeIn()):r.val(t).trigger("change"),void 0===w[n.code]&&(w[n.code]={}),o?void 0===w[n.code][o]&&(w[n.code][o]=e):w[n.code]=e,1<e.length&&m.hide()},getSelectedCountryData:function(){var e=c("option:selected",h).data(),n=e.flavor,o=e.lang,r=e.sample,t=e.regexp;return{flavor:n,code:c("option:selected",h).val(),lang:o,sample:r,regexp:t}},resetAll:function(){b.resetLists(),T=[],(C=x).val(""),f.val(""),n=a="",c(".lineup-dynamic").hide(),P.removeAttr("data-remodal-target"),null===g&&(g=v.remodal({hashTracking:!1})),u=g},resetLists:function(){N=[],T=[],R=[],A=0},displayError:function(e,n){m.hide(),c("span",_).text(e),c("span",O).text(e),_.fadeIn(),O.fadeIn(),n&&console.log(n)},normalizeLineupType:function(e){switch(e){case"CAB":e="CABLE";break;case"SAT":e="SATELLITE";break;case"DBC":e="OTA"}return e},validatePostalCode:function(e){return!o.regexp||new RegExp(o.regexp,"gm").test(e)},filterPostalCode:function(e){if(!o.regexp)return!0;var n=new RegExp(o.regexp,"gm").exec(e);return!!n&&(1<n.length&&void 0!==n[1]?e.replace(n[1],""):n[0])},abortRequest:function(){p&&4!==p.readyState&&(m.hide(),p.abort())}};c(document).on("opening",v.selector,function(){c(".lineup-dynamic").hide()}),c(document).on("opened",v.selector,function(){a=C.val(),n=f.val(),0<=c.inArray(o.code.toUpperCase(),s)&&!T.length?b.EyeQ.getRegions(o,n):1<T.length?b.populateRegionsDropown(T):0!==o.flavor||a?b.getLineups(o,a,n):b.EyeQ.getRegions(o)}),c(document).on("closed",v.selector,function(){}),c(document).on("change",h.selector,function(e,n){b.abortRequest(),(f=c(f.selector)).removeClass("required"),h.val(c(this).val()),o=b.getSelectedCountryData(),b.selOptions.country=o,b.resetAll(),0===o.flavor?(f.attr("disabled",!0),y.addClass("zipcode-disabled"),(void 0===n||n.lookup)&&c(this).closest(".channel-lookup-group").find(P).click()):(f.removeAttr("disabled"),y.removeClass("zipcode-disabled"),f.addClass("required"),f.attr("placeholder","i.e: "+o.sample),f.closest(".lineup-dynamic").fadeIn())}),c(document).on("keyup",f.selector,function(e){!c(this).hasClass("required")||c(this).val()?13===e.which&&c(this).closest(".channel-lookup-group").find(P).click():b.resetAll()}),c(document).on("click",P.selector,function(e){return L=c(this).closest(".channel-lookup-group"),f=L.find(f.selector),(_=L.find(_.selector)).hide(),f.hasClass("required")&&!f.val()?(b.displayError(plex_l10n.dvr.error.no_zip_code),!1):b.validatePostalCode(f.val())?void u.open():(b.displayError(plex_l10n.dvr.error.invalid_zip_code+" (i.e: "+o.sample+")."),!1)}),c(document).on("change",C.selector,function(e){b.abortRequest(),c(this).val()&&(o=b.selOptions.country,n=f.val(),a=c(this).val(),b.selOptions.regionId=a,N=[],A=0,I.hide(),E.hide(),_.hide(),O.hide(),c(this).addClass("disabled"),b.getLineups(o,a,n))}),c(document).on("change",".lineups-dropdown",function(e){if(b.abortRequest(),c(this).val()){var n=c(this).val(),o=b.selOptions.country,r=c(this).find(":selected").data("provider");b.selOptions.lineupId=n,b.selOptions.providerId=r,I.hide(),_.hide(),O.hide(),b.getLineupChannels(o,n)}}),c(document).ready(function(){if("undefined"!=typeof Transifex){var e=Transifex.live.getSourceLanguage();void 0!==e&&(d=e.code)}else d=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage;"en_US"!==(d=d.replace("_","-").toLowerCase())&&h.find("[data-browser-lang*="+d+"]").length||(d="en-us"),l&&(h.find("[data-browser-lang*="+d+"]").prop("selected",!0),h.trigger("change",{lookup:!1}),l=!1)})}(jQuery,window);