"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){var r=1044,n={isUnrecoverable:function(e,t){return!e||e.some(function(e){return 1056===e.code||1064===e.code&&"facebook"===t||e.isUnrecoverable})},isRecoverableByClearingProviderAuth:function(e,t){return"google"===t&&e.some(function(e){return 1064===e.code})},isAdditionalAuthNeeded:function(e){return e.some(function(e){return e.code===r})},isAdditionalAuthPassword:function(e){return e.some(function(e){return e.code===r&&!0===e.hasPassword})},additionalAuthProviderIDs:function(e){return e.reduce(function(t,e){return e.code===r&&e.providers.split(",").forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),t},[])},getErrorEmail:function(e){return e.code===r?e.email:null},additionalAuthEmail:function(e){var t=e.find(n.getErrorEmail);return t?n.getErrorEmail(t):null},isIgnorable:function(e){return e.some(function(e){return e.isIgnorable})},getSignInErrorMessage:function(e){var t=e&&e[0];return t?"object"===(void 0===t?"undefined":_typeof(t))?t:{code:0,message:t}:{code:0,message:"There was a problem signing in to Plex."}},trackMetricsEvents:function(){var e=PlexModel.getSignInModel().get();function t(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e}var r="fedAuth"+t(e.action)+t(e.providerID)+"["+(e.isModal?"modal":"page")+"]";PlexMetrics.pushEvent(r)}};t.PlexHelpers=n}(jQuery,window);var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function ajax(e){var t=e.method,r=void 0===t?"GET":t,n=e.url,d=e.data,l=e.raw,o=e.headers,u=void 0===o?{}:o;return new Promise(function(o,i){var s=new window.XMLHttpRequest,a=!(s.withCredentials=!0);for(var e in s.ontimeout=function(){a=!0},s.open(r,n),u)s.setRequestHeader(e,u[e]);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),s.onreadystatechange=function(){if(a&&i(),4===s.readyState){var e=s.status,t=200<=e&&e<300||304===e,r=s.responseText;if(l)t?o(r):i({status:e,response:r});else{var n=void 0;try{n=JSON.parse(s.responseText)}catch(e){t=!1}t?o(n):i({status:e,json:n})}}},s.send(stringifyParams(_extends({"X-Plex-Client-Identifier":plexClientIdentifier},d)))})}function getByPostMessage(e){var t=$.Deferred();return getPostMessage({url:replaceUrlProtocol(window.location.origin,"https:")+"/service-reflector",data:e,timeout:5e3,onMessage:function(e){!0===e.success?t.resolve(e.data,getStatusText(e.xhr),e.xhr):!1===e.success&&t.reject(e.xhr,getStatusText(e.xhr))}}),t.promise()}function getPostMessage(e){var t=e.url,r=e.data,n=e.onMessage,o=e.timeout,i=setTimeout(function(){n({success:!1}),s()},o);function s(){window.document.body.removeChild(d),window.removeEventListener("message",a),clearTimeout(i)}function a(e){if(e.source===d.contentWindow){var t=void 0;try{t=JSON.parse(e.data)}catch(e){}t&&(n(t),s())}}window.addEventListener("message",a);var d=window.document.createElement("iframe");d.style.display="none",d.src=t+"#"+encodeURIComponent(JSON.stringify({data:r})),window.document.body.appendChild(d)}!function(c,f){var e={run:function(e){var t=e.method,r=void 0===t?"GET":t,n=e.url,d=e.data,l=e.raw,o=e.headers,u=void 0===o?{}:o;return new Promise(function(o,i){var s=new f.XMLHttpRequest,a=!(s.withCredentials=!0);for(var e in s.ontimeout=function(){a=!0},s.open(r,n),u)s.setRequestHeader(e,u[e]);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),s.onreadystatechange=function(){if(a&&i(),4===s.readyState){var e=s.status,t=200<=e&&e<300||304===e,r=s.responseText;if(l)t?o(r):i({status:e,response:r});else{var n=void 0;try{n=JSON.parse(s.responseText)}catch(e){t=!1}t?o(n):i({status:e,json:n})}}};var t=_extends({"X-Plex-Client-Identifier":Plex.getClientIdentifier()},d);s.send(c.param(t))})},getUserAPIPromise:function(e){var t={"X-Plex-Product":"Plex SSO","X-Plex-Client-Identifier":Plex.getClientIdentifier()};return e.headers=_extends({},t,e.headers||{}),c.ajax(e)},minDuration:function(e,t){var n=c.Deferred(),r=(new Date).getTime()+t,o=void 0;function i(){var e=(new Date).getTime(),t=Math.max(r-e,0);setTimeout(o,t)}return e.then(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o=function(){return n.resolve.apply(n,t)}},function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];o=function(){return n.reject.apply(n,t)}}),e.then(i,i),n.promise()},maxDuration:function(e,t){var r=c.Deferred(),n=setTimeout(function(){r.reject()},t);return e.then(r.resolve,r.reject).always(function(){clearTimeout(n)}),r.promise()},alwaysResolve:function(e){var t=c.Deferred();return e&&e.then?e.then(t.resolve,t.resolve):t.resolve(e),t.promise()}};f.PlexAjax=e}(jQuery,window);_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};!function(o,r){var t=["email","profile"],n="AIzaSyAZQ6pxlxG7Taa8W7ons7idJAfG1W9qriE",i="954396107311-vpdi0ie6905j1pr8udc2v1drm9p0kn0p.apps.googleusercontent.com";function e(){return function(){if("undefined"!=typeof gapi)return o.Deferred().resolve().promise();var e=o.Deferred(),t=r.document.createElement("script");return t.src="https://apis.google.com/js/api.js",t.async=!0,t.defer=!0,t.onload=function(){e.resolve()},t.onreadystatechange=function(){"complete"===t.readyState&&e.resolve()},t.onerror=function(){e.reject(["Could not reach Google"])},e.always(function(){r.document.body.removeChild(t),t.onload=null,t.onerror=null}),r.document.body.appendChild(t),e.promise()}().then(s)}function s(){var e=o.Deferred();return gapi.load("client:auth2",function(){gapi.client.init({apiKey:n,clientId:i,scope:t.join(" "),discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}).then(function(){e.resolve()},function(){e.reject()})}),e.promise()}function a(e){return e.hasGrantedScopes(t.join(" "))?o.Deferred().resolve(e.getAuthResponse().id_token).promise():o.Deferred().reject().promise()}function d(){var e=o.Deferred(),t=gapi.auth2.getAuthInstance().currentUser.get();return t.reloadAuthResponse().then(function(){e.resolve(t)},function(){e.reject()}),e.promise()}var l={preload:function(){return PlexAjax.maxDuration(e(),3e4).then(function(){return PlexAjax.alwaysResolve(d().then(function(e){return o.when(a(e),(t=gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile(),o.Deferred().resolve(t.getEmail()).promise()));var t}).then(function(e,t){return{providerToken:e,email:t}},function(){return{}}))})},auth:function(t,r){return PlexAuthFederated.isFederatedAuthSubmittable(t)?PlexAuthFederated.authFederated(t,r):(n=o.Deferred(),gapi.auth2.getAuthInstance().signIn().then(function(e){n.resolve()},function(e){n.reject([{isIgnorable:!0}])}),n.promise()).then(d).then(a).then(function(e){return PlexAuthFederated.authFederated(_extends({},t,{providerToken:e}),r)});var n}};r.PlexAuthGoogle=l}(jQuery,window);_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};!function(r,n){var o=["email","public_profile"];function i(){var t=r.Deferred();return FB.api("/me/permissions",function(e){e.error?t.reject([e.error.message]):0===e.data.reduce(function(e,t){var r=t.permission,n=t.status;return-1===o.indexOf(r)||("granted"===n?e.granted.push(r):e.missing.push(r)),e},{missing:[],granted:[]}).missing.length?t.resolve():t.reject(["Plex needs access to your Facebook email address"])}),t.promise()}function s(){var t=r.Deferred();return FB.getLoginStatus(function(e){"connected"===e.status?t.resolve():t.reject()}),t.promise()}function e(e){var t=r.Deferred();return FB.login(function(e){!e.error&&e.authResponse||t.reject([{isIgnorable:!0}]),t.resolve()},{scope:o.join(","),auth_type:e}),t.promise()}function a(){var e=FB.getAuthResponse().accessToken;return r.Deferred().resolve(e).promise()}var t={preload:function(){return PlexAjax.maxDuration(function(){if("undefined"!=typeof FB)return r.Deferred().resolve().promise();var t=r.Deferred(),e=document.createElement("script");return e.src="//connect.facebook.net/en_US/sdk.js",e.onerror=function(){t.reject()},n.fbAsyncInit=function(){FB.init({appId:"1405987639482438",cookie:!0,xfbml:!1,version:"v2.9"}),FB.AppEvents.logPageView(),FB.getLoginStatus(function(e){t.resolve()},!0)},t.always(function(){n.document.body.removeChild(e),e.onerror=null,delete n.fbAsyncInit}),n.document.body.appendChild(e),t.promise()}(),3e4).then(function(){var e=s().then(i).then(function(){return r.when(a(),(t=r.Deferred(),FB.api("/me",{fields:"email"},function(e){t.resolve(e.email)}),PlexAjax.maxDuration(t.promise(),1e4)));var t}).then(function(e,t){return{providerToken:e,email:t}},function(){return{}});return PlexAjax.alwaysResolve(e)})},auth:function(t,r){return PlexAuthFederated.isFederatedAuthSubmittable(t)?PlexAuthFederated.authFederated(t,r):s().then(function(){return e("rerequest")},function(){return e(null)}).then(i).then(a).then(function(e){return PlexAuthFederated.authFederated(_extends({},t,{providerToken:e}),r)})}};n.PlexAuthFacebook=t}(jQuery,window),function(o,e){var t={LOAD_FEDERATED_AUTH_PROVIDER_HELPERS:{facebook:PlexAuthFacebook.preload,google:PlexAuthGoogle.preload},USE_FEDERATED_AUTH_PROVIDER_HELPERS:{facebook:PlexAuthFacebook.auth,google:PlexAuthGoogle.auth},federatedAuthProviders:{google:{providerID:"google",label:"Google"},facebook:{providerID:"facebook",label:"Facebook"}},authFederated:function(t,r){var n=o.Deferred(),e=PlexUtils.getAPIUrl()+"/api/v2/users/authenticate";return r.authToken&&(t["X-Plex-Token"]=r.authToken),PlexAjax.getUserAPIPromise({url:e,type:"POST",data:t,dataType:"json",xhrFields:{withCredentials:!0}}).done(function(e){n.resolve({authToken:e.authToken,uuid:e.uuid,metricsEvent:e.created?PlexSignUp.SIGN_UP:PlexSignIn.SIGN_IN,metricsMode:t.provider,isFirstRun:r.isFirstRun,response:e})}).then(null,function(e){var t=e&&e.status?e.responseJSON.errors:null;n.reject(t)}),n.promise()},isFederatedAuthSubmittable:function(e){var t=e.provider,r=e.providerToken,n=e.verifyProvider,o=e.verifyProviderToken;return t&&r&&(!n||n&&o)}};e.PlexAuthFederated=t}(jQuery,window),function(n,e){var o={providers:[],signIn:null},t={set:function(e){this.sessionAttrs=n.extend(!0,this.sessionAttrs,e)},get:function(){return this.sessionAttrs},reset:function(){this.sessionAttrs=n.extend(!0,this.sessionAttrs,this.defaults)}},r={signin:{title:"Sign In",class:".signin-dynamic"},signup:{title:"Sign Up",class:".signup-dynamic"},reset:{title:"Reset Password",class:".reset-dynamic"}},i=n.extend({name:"SignInPageModel",defaults:{departureMessage:"",errorMessage:"",myPlexAccessToken:"",providerID:"",providerToken:"",isBusy:!1,isAdditionalAuthNeeded:!1,isAdditionalAuthPassword:!1,isSuccess:!1,isModalAuth:!1,additionalAuthEmail:"",additionalAuthProviderIDs:[],ssoEmail:"",ssoMyPlexAccessToken:"",isResetPasswordSubmitted:!1,isResetPasswordError:!1},sessionAttrs:{action:"signin",isModal:!1,isSignUp:!1,departureMessage:"",errorMessage:"",myPlexAccessToken:"",providerID:"",providerToken:"",isBusy:!1,isAdditionalAuthNeeded:!1,isAdditionalAuthPassword:!1,isSuccess:!1,isModalAuth:!1,additionalAuthEmail:"",additionalAuthProviderIDs:[],ssoEmail:"",ssoMyPlexAccessToken:"",isResetPasswordSubmitted:!1,isResetPasswordError:!1}},t),s=n.extend({name:"FederatedAuthProviderModel",context:["signInPageModel"],rootPropertyName:"provider",sessionAttrs:{isLoading:!0,isError:!1,label:"",providerID:"",providerToken:"",email:""}},t),a={getFormModel:function(e){return r[e]},getFedAuthProviderModel:function(e,t){var r=n.extend(!0,{},s);return void 0!==t?r:(o.providers[e]=n.extend(!0,r,o.providers[e]),o.providers[e])},getSignInModel:function(){var e=n.extend(!0,{},i);return o.signIn=n.extend(!0,e,o.signIn),o.signIn}};e.PlexModel=a}(jQuery,window),function(n,e){var r={SIGN_IN:"signin",signIn:function(e,t){return PlexAjax.getUserAPIPromise({url:PlexUtils.getAPIUrl()+"/api/v2/users/signin",type:"POST",data:e,dataType:"json",xhrFields:{withCredentials:!0}}).then(function(e){return{authToken:e.authToken,uuid:e.uuid,metricsEvent:r.SIGN_IN,metricsMode:"password",metricsFirstRun:!0,isFirstRun:t.isFirstRun,response:e}},function(e){return n.Deferred().reject(e&&e.status?e.responseJSON.errors:[]).promise()})},loadSSO:function(){return PlexAjax.getUserAPIPromise({url:PlexUtils.getAPIUrl()+"/api/v2/users/signin",method:"POST",data:{login:"",password:"",skipAuthentication:!0},dataType:"json",xhrFields:{withCredentials:!0}}).then(function(e){var t=PlexModel.getSignInModel();t.set({ssoMyPlexAccessToken:e.authToken,ssoEmail:e.email});var r="0"!==e.rememberExpiresAt;return e=n.extend({roles:[]},e),Plex.setAuthInfo(e,r),t.get()})}};e.PlexSignIn=r}(jQuery,window),function(t,e){var r={SIGN_OUT:"signout",signOut:function(e){return PlexAjax.getUserAPIPromise({url:PlexUtils.getAPIUrl()+"/api/v2/users/signout",type:"DELETE",dataType:"json",xhrFields:{withCredentials:!0},headers:{"X-Plex-Token":e}}).then(function(e){},function(e){return t.Deferred().reject(e&&e.status?e.responseJSON.errors:[]).promise()})}};window.PlexSignOut=r}(jQuery),function(r,e){var n={SIGN_UP:"signup",signUp:function(e,t){return PlexAjax.getUserAPIPromise({url:PlexUtils.getAPIUrl()+"/api/v2/users",type:"POST",data:e,dataType:"json",xhrFields:{withCredentials:!0}}).then(function(e){return{authToken:e.authToken,uuid:e.uuid,metricsEvent:n.SIGN_UP,metricsMode:"password",isFirstRun:t.isFirstRun,response:e}},function(e){return r.Deferred().reject(e&&e.status?e.responseJSON.errors:[]).promise()})}};e.PlexSignUp=n}(jQuery,window),function(e,t){var r={resetPassword:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return PlexAjax.getUserAPIPromise({url:PlexUtils.getAPIUrl()+"/api/v2/users/password",type:"POST",data:{email:e.email}})}};window.PlexReset=r}(jQuery);_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(p,h){var e,m=(_defineProperty(e={},PlexSignUp.SIGN_UP,"SignUpSuccess"),_defineProperty(e,PlexSignIn.SIGN_IN,"SignInSuccess"),e),t={loadProvider:function(e,t){var r=e.options.providerID,n=PlexModel.getFedAuthProviderModel(r);n.set(_extends({isLoading:!0,isError:!1},PlexAuthFederated.federatedAuthProviders[r])),(0,PlexAuthFederated.LOAD_FEDERATED_AUTH_PROVIDER_HELPERS[r])().then(function(e){n.set(_extends({isLoading:!1,isError:!1},e)),t(r)},function(e){n.set({isLoading:!1,isError:!0}),t(r,e)})},authProvider:function(e,t,r){var n=t.options.providerID,o=PlexModel.getFedAuthProviderModel(n);return o.set({isLoading:!0}),i(function(){var e=PlexAuthFederated.USE_FEDERATED_AUTH_PROVIDER_HELPERS[n].apply(void 0,arguments);return e.fail(function(e){o.set({isLoading:!1})}),e})(e,t,r)},signin:i(PlexSignIn.signIn),signup:i(PlexSignUp.signUp),signout:function(e){var t,r,n;t=e,r=Plex.getSignInPage("/?"),n={forwardUrl:t},PlexSignOut.signOut(Plex.getAuthToken()).always(function(){Plex.removeAuthInfo(),void 0!==t&&(r+=function e(t,r){var n,o=[];for(n in t)if(t.hasOwnProperty(n)){var i=r?r+"["+n+"]":n,s=t[n];o.push(null!==s&&"object"===(void 0===s?"undefined":_typeof(s))?e(s,i):encodeURIComponent(i)+"="+encodeURIComponent(s))}return o.join("&")}(n),PlexUtils.redirect(r))})},reset:function(e,t,r){var n=PlexModel.getSignInModel();n.set({isBusy:!0,isResetPasswordError:!1}),PlexAjax.minDuration(PlexReset.resetPassword(t.formData),1e3).done(function(){n.set({isResetPasswordSubmitted:!0}),PlexHelpers.trackMetricsEvents()}).fail(function(){n.set({isResetPasswordError:!0})}).always(function(e,t){n.set({isBusy:!1}),r(n,e)})},trackClicks:function(e,t,r){var n={context:p(location).attr("origin")+p(location).attr("pathname")+(r?t+"[modal]":"")};if("signup"!==e&&("signin"!==e||"signup"===t)){var o={reset:"forgotPassword","terms-of-service":"termsOfService","privacy-policy":"privacyPolicy",signin:"signIn"};e=void 0!==o[e]?o[e]:e,PlexMetrics.track("click",e,{properties:n})}}};function i(a){return function(e,t,c){var f=PlexModel.getSignInModel(),r=t.formData,n=t.options,o=r.providerToken,i=r.password,g=n.providerID,s=(n.forwardUrl,{isBusy:!0,errorMessage:null,providerID:g,providerToken:o});f.set(s),a(r,n,e).then(function(e){var t=e.metricsEvent,r=e.metricsMode,n=e.isFirstRun,o=e.authToken,i=e.uuid,s=e.response;PlexMetrics.track(t,t,{properties:{mode:r,firstRun:n}}),PlexHelpers.trackMetricsEvents();var a=Cookies.get("plex_tv_cj");a&&(a=JSON.parse(a));var d=null;void 0!==a&&void 0!==a.CJEVENT&&(d=a.CJEVENT),h.PLEX_USER_UUID=i,h.PLEX_CJ_EVENT=d,h.PLEX_HAS_CJ_COOKIE=!!a;var l=m[t];l&&PlexMetrics.pushEvent(l),f.set({isSuccess:!0,myPlexAccessToken:o,providerID:g}),void 0!==s.created&&f.set({action:s.created?"signup":"signin"});var u="0"!==s.rememberExpiresAt;s=p.extend({roles:[]},s),Plex.setIsSigninIn(),Plex.setAuthInfo(s,u),void 0!==c&&c(f)}).fail(function(e){var t={isBusy:!1};if(!e||PlexHelpers.isUnrecoverable(e,g))t.errorMessage=PlexHelpers.getSignInErrorMessage(e);else if(PlexHelpers.isRecoverableByClearingProviderAuth(e,g)){PlexModel.getFedAuthProviderModel(g).set({providerToken:null}),t.errorMessage=PlexHelpers.getSignInErrorMessage(e)}else!i&&PlexHelpers.isAdditionalAuthNeeded(e)?(t.isAdditionalAuthNeeded=!0,t.isAdditionalAuthPassword=PlexHelpers.isAdditionalAuthPassword(e),t.additionalAuthEmail=PlexHelpers.additionalAuthEmail(e),t.additionalAuthProviderIDs=PlexHelpers.additionalAuthProviderIDs(e)):PlexHelpers.isIgnorable(e)||(t.errorMessage=PlexHelpers.getSignInErrorMessage(e));f.set(t),void 0!==c&&c(f,e)})}}h.PlexSignInActions=t}(jQuery,window);_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};!function(w,y){var b=0,I=-1,S=!1;function M(e,t){var r={fedAuthModal:".modal-fedauth",fedAuthRemodal:".remodal-fedauth",panelRightTop:".fedauth-panel-top",panelLeft:".fedauth-panel-left",panelRight:".fedauth-panel-right",panelRightBottom:".fedauth-panel-bottom",fedAuthTitle:".fedauth-title",fedAuthTitleDesc:".fedauth-title-desc",toggleForm:".toggle-form",fedAuthForm:".fedauth-form",fedAuthFormSuccess:".fedauth-form-success",fedAuthActionSuccess:".fedauth-form-success .action-success",passwordFieldWraper:".fedauth-form-field-password",togglePasswordField:".fedauth-form-field-password .show-hide-password",passwordInput:".fedauth-form-field-password #password",passwordStrengthTitle:".fedauth-form-field-password .strength-title",passwordStrengthBar:".fedauth-form-field-password .strength-bar",passwordStrengthMeter:".fedauth-form-field-password .meter",fedAuthFieldWraper:".fedauth-form-field",fedAuthFieldsWraper:".fedauth-form-fields",fedAuthField:"input.fedauth-field",fedAuthAction:".fedauth-action",fedAuthBtWrapper:".fedauth-button",fedAuthButton:".fedauth-button.button",fedAuthActionButton:".fedauth-button.basic-action button",fedAuthProviderButton:".fedauth-button.fedauth-action button",fedauthActionToggle:".fedauth-toggle",resetComplete:".reset-complete-dynamic",verifyAccount:".verify-account-dynamic",verifyAccountUser:".verify-account-dynamic .verify-user",verifyAccountProvider:".verify-account-dynamic .verify-provider"};return void 0!==t?r[e]:w(r[e])}var i={isModal:!1,context:"signin",start:function(e,t){if(i.isModal=t,S=!1,PlexUtils.getParam("reset")&&(e="reset"),i.context=e,"https:"!==y.location.protocol)return R("","Insecure protocol");function r(e){var t,r,n=!0,o="",i=w("[data-remodal-id="+y.modalFedAuth+"]"),s=i.remodal();void 0!==i&&i.find(".remodal-close").hide(),e.ssoMyPlexAccessToken&&w(".status-check").text("You are already signed in, please wait ..."),F(PlexModel.getFormModel(e.action).class),t=e.action,r=i,g(!0,t),void 0!==r&&r.find(".remodal-close").hide(),void 0!==s?(setTimeout(function(){s.close()},1e3),n=!1):setTimeout(function(){},1e3),PlexUtils.getParam("forwardUrl")&&(o=PlexUtils.getParam("forwardUrl")),o?PlexUtils.redirect(o):PlexUtils.isMobile()&&"signup"===e.action?PlexUtils.redirect("/onboard/mobile/"):"signup"!=e.action||PlexUtils.getParam("skipWeb")?n&&PlexUtils.redirect():PlexUtils.redirect(PlexUtils.getWebUrl())}function n(){U()}function o(e,t){var r=w("."+e).find("button"),n=PlexModel.getFedAuthProviderModel(e).get();n.isError&&void 0!==t&&R(t[0].code,t[0].message),U(r,!0,n.isError)}w(document).ready(function(){!function(e,a,s){var t=M("fedAuthModal"),r=M("fedAuthRemodal"),n=M("panelRight"),o=M("fedAuthForm"),i=M("fedAuthField"),d=M("fedAuthAction"),l=M("fedAuthActionButton"),u=M("fedAuthFieldWraper","classname"),c=M("fedAuthActionButton","classname"),f=M("fedAuthProviderButton","classname"),g=M("toggleForm","classname"),p=M("passwordInput","classname"),h=M("togglePasswordField","classname"),m=M("passwordInput"),v="";function P(e){if(e=void 0!==e?e.get():signinPlexModel.getSignInModel().get(),s(),e.isSuccess)a(e);else{if(e.isAdditionalAuthPassword){var t=e.additionalAuthEmail,r=e.providerID,n=M("verifyAccount","classname"),o=M("verifyAccountUser"),i=M("verifyAccountProvider");PlexModel.getSignInModel().set({action:"signin"}),U(d.find("."+r),!1,e.isError),F(n,"provider-password"),o.text(t),i.text(r.charAt(0).toUpperCase()+r.slice(1))}e.errorMessage&&R(e.errorMessage.code,e.errorMessage.message)}}function x(e,t){var r=PlexModel.getSignInModel(),n=PlexModel.getFedAuthProviderModel(e),o={forwardUrl:PlexUtils.getParam("forwardUrl"),isFirstRun:!1,providerID:e};r.get().isAdditionalAuthNeeded||r.reset(),PlexSignInActions.authProvider(n,{options:o,formData:t},P)}function A(e){var t=PlexModel.getSignInModel().get();return t.action===e}T(null,e),t.show(),r.find(".remodal-close").fadeIn("slow"),w(document).on("click",g,{panel:n},function(e){e.preventDefault(),T(e,null,o)}),w(document).on("touchstart mousedown",c+":not(.disabled, .isLoading)",function(e){e.preventDefault(),o.validate()}),w(document).on("click",f+":not(.disabled, .isLoading)",function(){var e=w(this).data("provider"),t={provider:e,password:""};D(w(this)),x(e,t)}),w.validator.addMethod("emailFormat",function(e,t,r){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},".email-format"),w.validator.addMethod("invalidExists",function(e,t,r){return!w(t).parent().is(".temp-email-exists")},".email-exists"),w.validator.addMethod("checkEmail",function(t,r,e){return v===t?!w(r).parent().is(".email-exists"):(w.ajax({url:PlexUtils.getAPIUrl()+"/users/check_email.json",headers:{"X-Plex-Product":"Plex Web","X-Plex-Client-Identifier":Plex.getClientIdentifier()},type:"GET",data:{email:t},complete:function(e){v=t,w(r).parent().removeClass("email-exists temp-email-exists"),o.off("keyup.validator");200!==e.status&&(w(r).parent().addClass("email-exists temp-email-exists"),o.on("keyup.validator",w(r),function(){w(r).parent().removeClass("temp-email-exists")})),w(r).valid()}}),!1)},".email-validating"),w.extend(w.validator.messages,{email:".email-format"}),o.validate({debug:!0,onkeyup:function(){return S=!0},rules:{email:{required:{depends:function(e){return!A("signin")}},emailFormat:{depends:function(e){return!A("signin")}},invalidExists:{depends:function(e){return A("signup")}},checkEmail:{depends:function(e){return A("signup")}}},login:{required:{depends:function(e){return A("signin")}}},password:{required:!0,minlength:{param:8,depends:function(e){return A("signup")}}}},messages:{email:{required:".email-required",emailFormat:".email-format",checkEmail:".email-validating",invalidExists:".email-exists"},login:{required:".login-required"},password:{required:".password-required",minlength:".password-length"}},showErrors:function(e,t){void 0!==y.event&&"submit"===y.event.type&&j(),w.each(this.validElements(),function(e,t){E(w(t))}),w.each(t,function(e,t){"checkEmail"!==t.method&&E(w(t.element),t.message)})},submitHandler:function(e){if(!l.is(".isLoading, .disabled")){var t=_extends({},function(e){for(var t={},r=0;r<e.length;r++)t[e[r].name]=e[r].value;return t}(w(e).serializeArray())),r=PlexModel.getSignInModel(),n=r.get();if(D(l),n.isAdditionalAuthNeeded){var o=PlexModel.getFedAuthProviderModel(n.providerID).get(),i={login:o.email,provider:o.providerID,providerToken:o.providerToken};t=w.extend(t,i),x(n.providerID,t)}else{var s=PlexSignInActions[n.action];s(r,{options:{isFirstRun:!1},formData:t},function(e,t){var r=e.get(),n=M("resetComplete","classname");U(),r.isResetPasswordSubmitted?r.isResetPasswordError?R(99):F(n):r.errorMessage?R(r.errorMessage.code,r.errorMessage.message):r.isSuccess?a(r):R("","Authentication Error")})}}}}),w(document).on("keyup",p,function(n){A("signup")&&(clearTimeout(b),b=setTimeout(function(){var e=w(n.currentTarget),t=zxcvbn(e.val()),r=M("passwordStrengthBar");if(I=t.score,!e.val())return w(".meter").animate({width:"100%",marginLeft:"0%"},{complete:function(){r.fadeOut()}}),C("hide"),void(I=-1);0==I?I+=1:2<I&&(I=5),C("show")}.bind(this),350))}).focus(function(e){A("signup")&&C("show")}),w(document).on("click",h,function(){var e=w(".icon-toggle-pass");return"text"===m.attr("type")?(m.attr("type","password"),m.closest(u).removeClass("pass-toggle-on").addClass("pass-toggle-off")):(m.attr("type","text"),m.closest(u).removeClass("pass-toggle-off").addClass("pass-toggle-on")),e.toggleClass(e.data("show")+" "+e.data("hide")),!1}),w(document).on("keyup","input",function(){"login"!==w(this).attr("id")&&"email"!==w(this).attr("id")||i.filter(".fedoff").not("[id=password]").val(w(this).val())}).on("focus","input",function(){var e=w(this).closest(u),t=e.find(".toggable-icon");e.addClass("field-active"),k(t,"default")}).on("blur","input",function(){w(this).closest(u).removeClass("field-active")})}(e,r,n)}),PlexSignIn.loadSSO().then(r,function(e){var t,r=e.status;400===r||401===r?(t=M("fedAuthProviderButton"),Plex.isSignedIn()&&Plex.removeAuthInfo(!0),D(t.filter(".google"),!0),PlexSignInActions.loadProvider({options:{providerID:"google"}},o),D(t.filter(".facebook"),!0),PlexSignInActions.loadProvider({options:{providerID:"facebook"}},o)):R("","Authentication Error")})}};function E(e,t,r){var n=PlexModel.getSignInModel().get(),o=e.parent(),i=o.find(".toggable-icon"),s=w(".validation-errors");if(t)o.find(".default-label:not(.fedoff)").hide(),r?o.find(t).show():(o.find(".alt-label").removeClass("alt-label").hide(),o.find(".error").html(s.find(t).text()).show(),o.removeClass("field-success").addClass("field-error"));else{if(e.val()&&e.is(":focus")&&o.find("label.alt-label").length)return;o.removeClass("field-success field-error"),o.find(".error").html("").hide(),"signup"===n.action&&e.val()&&o.addClass("field-success"),o.find(".alt-label:not(.fedoff)").removeClass("alt-label").hide(),o.find(".default-label:not(.fedoff)").show()}e.is(":focus")||k(i,o.is(".field-error")?"error":o.is(".field-success")?"success":"default")}function T(e,t,r){var n=PlexModel.getSignInModel();void 0!==e&&e?(e.preventDefault(),t=w(e.currentTarget).hasClass("reset-password")?"reset":w(e.currentTarget).hasClass("signin")?"signin":"signup",PlexSignInActions.trackClicks(t,i.context,i.isModal)):"#resetPassword"===PlexUtils.getURLHash()&&(t="reset");var o=PlexModel.getFormModel(t).class;n.reset(),PlexModel.getSignInModel().set({action:t,isModal:i.isModal}),F(o),S&&void 0!==r&&r.valid()}function F(e,t){var r,n,o,i,s,a,d,l,u,c=PlexModel.getSignInModel().get(),f=M("panelRight");t=void 0!==t?t:c.action,f.find(".toggable:not("+e+")").addClass("fedoff"),f.find(".toggable"+e).removeClass("fedoff"),f.find("form").attr("data-action",c.action),f.removeClass(function(e,t){return(t.match(/(^|\s)active-action-\S+/g)||[]).join(" ")}),f.addClass("active-action-"+t),j(),l=r=!0,M("panelRightTop").toggle(l),d=r,M("panelRightBottom").toggle(d),i=o=r,s=M("fedAuthTitle"),a=M("fedAuthTitleDesc"),s.toggle(o),a.toggle(i),n=r,M("fedAuthFieldsWraper").toggle(n),g(!r),(u=M("fedAuthFieldWraper")).removeClass("field-active field-error field-success"),u.find("label:not(.fedoff)").hide(),u.find("label.default-label:not(.fedoff)").show(),k(u.find(".toggable-icon"),"default"),C("hide")}function k(e,n){w.each(e,function(e,t){var r=w(t);w.each(r.data(),function(e,t){e===n?r.addClass(t):r.removeClass(t)})})}function g(e,t){var r=M("fedAuthFormSuccess"),n=M("fedAuthActionSuccess");r.toggle(e),e&&void 0!==t&&(n.toggle(!1),n.filter("."+t).show())}function C(e){var t=PlexModel.getSignInModel().get(),r=M("passwordFieldWraper"),n=M("passwordInput"),o=M("togglePasswordField"),i=M("passwordStrengthTitle"),s=M("passwordStrengthMeter"),a=M("passwordStrengthBar"),d=r.not(".field-error").find(".strength-title"),l={0:"poor",1:"poor",2:"weak",5:"strong"};if(r.removeClass("strength-poor strength-weak strength-strong"),"signup"===t.action)if(n.val()?o.removeClass("fedoff"):o.addClass("fedoff"),-1<I&&"show"===e){a.fadeIn(),i.removeClass("alt-label"),d.filter(":not(.strength-"+l[I]+")").hide();var u=d.filter(".strength-"+l[I]);u.addClass("alt-label"),E(n,u,!0),r.addClass("strength-"+l[I]),s.animate({width:100-20*I+"%",marginLeft:20*I+"%"})}else E(n);else o.addClass("fedoff")}function U(e,t,r){var n=PlexModel.getSignInModel().get(),o=PlexModel.getFormModel(n.action),i=M("fedauthActionToggle"),s=M("fedAuthFieldsWraper"),a=M("panelRight");s.is(":visible")&&i.show(),t&&void 0!==e&&e.removeClass("preLoading"),(e=a.find("button.isLoading:not(.preLoading)")).find(".loader").remove(),e.removeClass("isLoading"),e.each(function(e,t){var r=w(t).find(".button-label:not(.fedoff)");r.html(r.data("label"))}),void 0!==t&&t||a.find(".temp-disabled").removeClass("disabled temp-disabled").attr("disabled",!1),r||e.filter(".disabled").removeClass("disabled temp-disabled"),F(o.class)}function D(e,t){var r=e.find(".button-label:not(.fedoff)"),n=M("panelRight");j(),t?(e.addClass("preLoading"),o(e)):o(n.find("button"),!0),e.is(".isLoading")||(e.addClass("isLoading"),r.attr("data-label",r.html()).html(w(".field-spinner.loading").html()))}function o(e,t){var r=M("fedauthActionToggle"),n=M("fedAuthField");e.filter(":not(.disabled):not(.isLoading)").addClass("disabled temp-disabled"),n.filter(":not(.disabled):not(.isLoading)").addClass("disabled temp-disabled"),t&&(r.hide(),w(".disabled.temp-disabled").attr("disabled",!0))}function j(){w(".fedauth-form-errors, .validation-errors, .form-error").hide()}function R(e,t){w(".fedauth-form-errors.form-error").hide(),w(".fedauth-form-errors").show(),void 0===e&&(e=""),void 0===t&&(t=""),w(".plex-error-"+e).length?w(".plex-error-"+e).show():t&&w(".plex-error-other").text(t).show()}function s(e,t){t=void 0!==t&&t,i.start(e,t)}if(void 0!==y.modalFedAuth){var a={action:"signin",panels:"all"};w(document).on("fedauthModalOpened",function(e,t){t=w.extend(a,t);var r=w("[data-remodal-id="+y.modalFedAuth+"]"),n=r.remodal();(void 0!==r.attr("data-last-action")&&(t.action=r.attr("data-last-action"),r.removeAttr("data-last-action")),"right"===t.panels)&&M("getElement").hide();Plex.isSignedIn()?n.close():(PlexMetrics.track("view",t.action,{properties:{page:plex_l10n.curr_page+"[modal]"}}),s(t.action,!0))})}else w(document).on("fedAuthOpened",function(e,t){s(t)});w(document).ready(function(){w(document).on("click",".signin:not(.action), .go-signin",function(){return w(this).trigger("fedAuth",[{action:"signin",panels:"all"}]),!1}),w(document).on("click",".signup:not(.action), .go-signup",function(){return w(this).trigger("fedAuth",[{action:"signup",panels:"all"}]),!1}),w(document).on("click",".signout, .go-signout",function(){return PlexView.loading(),PlexSignInActions.signout(),!1}),w(document).on("click",".signout-other",function(){var e=location.href;return PlexView.loading(),void 0!==w(this).data("forward")&&(e=""),PlexSignInActions.signout(e),!1}),void 0!==y.modalFedAuth&&w(document).on("click",".remodal-privacy-policy, .remodal-terms",function(){PlexSignInActions.trackClicks(w(this).data("utm"),"signup",!0),w(document).on("closed",".remodal[data-remodal-id=remodal-privacy-policy], .remodal[data-remodal-id=remodal-terms]",function(e){w(".remodal[data-remodal-id="+y.modalFedAuth+"]").attr("data-last-action","signup"),w(".remodal[data-remodal-id="+y.modalFedAuth+"]").remodal().open(),w(this).off("closed")})})})}(jQuery,window);